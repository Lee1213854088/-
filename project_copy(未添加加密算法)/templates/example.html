<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>系统</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../static/css/layui.css">
</head>
<body>
<div class="layui-container"  style="width: 1070px; height: 1000px;">
    <table class="layui-hide" id="info"></table>
</div>
<script src="../static/js/layui.js"></script>
<!-- 工具栏模板 -->

<div class="layui-layout layui-layout-admin">
  <div class="layui-header">
    <div class="layui-logo layui-hide-xs layui-bg-black">layout demo</div>
    <!-- 头部区域（可配合layui 已有的水平导航） -->
    <ul class="layui-nav layui-layout-left">
      <!-- 移动端显示 -->
      <li class="layui-nav-item layui-show-xs-inline-block layui-hide-sm" lay-header-event="menuLeft">
        <i class="layui-icon layui-icon-spread-left"></i>
      </li>
      <li class="layui-nav-item layui-hide-xs"><a href="javascript:;">nav 1</a></li>
      <li class="layui-nav-item layui-hide-xs"><a href="javascript:;">nav 2</a></li>
      <li class="layui-nav-item layui-hide-xs"><a href="javascript:;">nav 3</a></li>
      <li class="layui-nav-item">
        <a href="javascript:;">nav groups</a>
        <dl class="layui-nav-child">
          <dd><a href="javascript:;">menu 11</a></dd>
          <dd><a href="javascript:;">menu 22</a></dd>
          <dd><a href="javascript:;">menu 33</a></dd>
        </dl>
      </li>
    </ul>
    <ul class="layui-nav layui-layout-right">
      <li class="layui-nav-item layui-hide layui-show-sm-inline-block">
        <a href="javascript:;">
          tester
        </a>
        <dl class="layui-nav-child">
          <dd><a href="javascript:;">Your Profile</a></dd>
          <dd><a href="javascript:;">Settings</a></dd>
          <dd><a href="javascript:;">Sign out</a></dd>
        </dl>
      </li>
      <li class="layui-nav-item" lay-header-event="menuRight" lay-unselect>
        <a href="javascript:;">
          <i class="layui-icon layui-icon-more-vertical"></i>
        </a>
      </li>
    </ul>
  </div>

  <div class="layui-side layui-bg-black">
    <div class="layui-side-scroll">
      <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
      <ul class="layui-nav layui-nav-tree" lay-filter="test">
        <li class="layui-nav-item layui-nav-itemed">
          <a class="" href="javascript:;">menu group 1</a>
          <dl class="layui-nav-child">
            <dd><a href="javascript:;">menu 1</a></dd>
            <dd><a href="javascript:;">menu 2</a></dd>
            <dd><a href="javascript:;">menu 3</a></dd>
            <dd><a href="javascript:;">the links</a></dd>
          </dl>
        </li>
        <li class="layui-nav-item">
          <a href="javascript:;">menu group 2</a>
          <dl class="layui-nav-child">
            <dd><a href="javascript:;">list 1</a></dd>
            <dd><a href="javascript:;">list 2</a></dd>
            <dd><a href="javascript:;">超链接</a></dd>
          </dl>
        </li>
        <li class="layui-nav-item"><a href="javascript:;">click menu item</a></li>
        <li class="layui-nav-item"><a href="javascript:;">the links</a></li>
      </ul>
    </div>
  </div>
<script type="text/html" id="toolbar">
  <div class="layui-btn-container" style="margin-top: 50px;">
    <div class="layui-container" style="width: 720px; float: right;">
        <form class="layui-form layui-row layui-col-space16">
            <div class="layui-col-md4">
                <div class="layui-input-wrap">
                    <div class="layui-input-prefix">
                        <i class="layui-icon layui-icon-username"></i>
                    </div>
                    <input type="text" name="salesman" value="" placeholder="请输入卖家" class="layui-input" lay-affix="clear">
                </div>
            </div>
            <div class="layui-col-md4">
                <div class="layui-input-wrap">
                    <input type="text" name="id" placeholder="请输入商单号" lay-affix="clear" class="layui-input">
                </div>
            </div>
            <div class="layui-btn-container layui-col-xs12">
                <button class="layui-btn layui-btn-sm" lay-submit lay-filter="table-search">查询</button>
                <button type="reset" class="layui-btn layui-btn-primary layui-btn-sm">重置</button>
            </div>
        </form>
    </div>
    <h1 style="height: 50px; margin-top: 70px;">交易记录查询</h1>
      <button class="layui-btn layui-btn-sm" lay-event="add">添加</button>
      <button class="layui-btn layui-btn-sm" lay-event="delete_many">删除</button>
  </div>

</script>

<!-- 编辑表单 -->
<div class="layui-table-box">

</div>
<form class="layui-form" action="" id="form_edit" lay-filter="form_edit" style="margin-top: 50px;display: none">
    <div class="layui-form-item">
        <label class="layui-form-label">商单号</label>
        <div class="layui-input-block">
            <input type="text" name="id" lay-verify="required" autocomplete="off" placeholder="请输入"
                   class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">卖家</label>
        <div class="layui-input-block">
            <input type="text" name="salesman" lay-verify="required" autocomplete="off" placeholder="请输入"
                   class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">买家</label>
        <div class="layui-input-block">
            <input type="text" name="buyer" lay-verify="required" autocomplete="off" placeholder="请输入"
                   class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">金额</label>
        <div class="layui-input-block">
            <input type="text" name="number" lay-verify="required" autocomplete="off" placeholder="请输入"
                   class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-input-block">
            <button type="submit" class="layui-btn" lay-submit lay-filter="edit-commit">立即提交</button>
            <button type="reset" class="layui-btn layui-btn-primary">重置</button>
        </div>
    </div>
</form>

<!-- 表头某列 templet 属性指向的模板 -->
<script type="text/html" id="tools">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>

<script>
    // 修改的方法
    const change_info = async (id, data) => {
    const options = {
        method: 'PUT',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
    }
    const response = await fetch(`/api/info/${id}`, options)
    return await response.json()
    }

    layui.use(function () {
        var table = layui.table;
        var $ = layui.$;
        var form = layui.form;
        var layuidata = layui.layuidata;
        // 已知数据渲染
        var inst = table.render({
            elem: '#info',
            id: 'info',
            toolbar: '#toolbar',
            url: '/api/test',
            cols: [
                [   // 标题栏
                    {field: 'id', title: '商单号', width: 140, sort: true},
                    {field: 'salesman', title: '卖家', width: 120},
                    {field: 'buyer', title: '买家', width: 120},
                    {field: 'number', title: '金额', width: 120,sort: true},
                    {title: '操作', width: 120, templet: '#tools'}
                ]],
            page: true,
            escape: true,
            limits: []
        });
        // 头部工具栏事件
        table.on('toolbar(info)', function (obj) {
            var options = obj.config; // 获取当前表格属性配置项
            var checkStatus = table.checkStatus(options.id); // 获取选中行相关数据

            // 根据不同的事件名进行相应的操作
            switch (obj.event) { // 对应模板元素中的 lay-event 属性值
                case 'add':
                    window.show_add()
                    break;
                case 'delete_many':
                    window.delete_many(obj)
                    break;
            }
        });

        window.show_add = function () {
            layer.open({
                type: 2,
                title: '新增记录',
                shadeClose: true,
                maxmin: true, //开启最大化最小化按钮
                area: ['900px', '400px'],
                content: '/info_add'
            });
        }


        window.delete_many = function (obj) {
            layer.msg('批量删除');
        }

        table.on('tool(info)', function (obj) {
        var layEvent = obj.event; // 获得元素对应的 lay-event 属性值
        if (layEvent === 'edit') { //编辑
            window.show_edit(obj)
        } else if (layEvent === 'del') { //删除
            layer.confirm('确定删除吗？', function (index) {
                layer.close(index);
                window.del_info(obj)
            });
        }
    });

        window.show_edit = (obj) => {
            console.log(obj.data)
            form.val('form_edit', obj.data);
            layer.open({
                type: 1,
                area: ['600px', '400px'],
                content: $('#form_edit'), // 捕获的元素
            });
        }

        window.del_info = (obj) => {
            layer.msg('删除学生数据')
        }

        form.on('submit(edit-commit)', function (data) {
            var field = data.field; // 获取表单字段值
            console.log(field)
            // 此处可执行 Ajax 等操作
            field.disable = field?.disable ? true : false

            change_info(field.id, field).then(function (ret) {

                // 提交成功之后的回调
                if (!ret.code) {
                    layer.msg(ret.msg, {
                        icon: 1,
                        time: 1000,
                    }, function () {
                        layer.closeAll('page');
                        table.reload('info');
                    });
                } else {
                    layer.msg(ret.msg, {
                        icon: 2,
                        time: 1000,
                    });
                }
            })
            return false; // 阻止默认 form 跳转
        });
    });

</script>
</body>
</html>